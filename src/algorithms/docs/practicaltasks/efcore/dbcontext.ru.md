# dbcontext

DbContext - это основной класс в EntityFramework, который представляет контекст базы данных. Он используется для управления жизненным циклом сущностей, выполнения операций CRUD (Create, Read, Update, Delete) с базой данных, настройки отношений между сущностями и других операций. Класс DbContext наследуется от класса ObjectContext и предоставляет удобный интерфейс для работы с базой данных.

Для добавления, изменения и удаления записей в базе данных с помощью DbContext используются следующие методы:
- `DbSet.Add(entity)` - добавляет новую запись в базу данных
- `DbSet.Attach(entity)` - присоединяет существующую запись к контексту базы данных
- `DbSet.Remove(entity)` - удаляет запись из базы данных
- `DbContext.SaveChanges()` - сохраняет все изменения в базе данных

DbContext поддерживает следующие типы наследования: Table per Hierarchy (TPH), Table per Type (TPT), Table per Concrete Type (TPC).

Для работы с транзакциями в DbContext используются следующие методы:
- `DbContext.Database.BeginTransaction()` - начинает новую транзакцию
- `DbContext.Database.CommitTransaction()` - коммитит текущую транзакцию
- `DbContext.Database.RollbackTransaction()` - откатывает текущую транзакцию

DbContext поддерживает следующие типы отношений между таблицами: один к одному, один ко многим, многие ко многим.

Для выполнения запросов к базе данных с помощью DbContext используются следующие методы:
- `DbSet.Where(predicate)` - выбирает записи из базы данных, удовлетворяющие условию
- `DbSet.OrderBy(orderByExpression)` - сортирует записи в базе данных по заданному выражению
- `DbSet.Include(navigationProperty)` - загружает связанные сущности из базы данных
- `DbContext.Database.SqlQuery(sqlQuery, parameters)` - выполняет SQL-запрос к базе данных

DbContext поддерживает следующие типы миграций: автоматические миграции и явные миграции. Автоматические миграции позволяют автоматически обновлять базу данных при изменении модели данных, а явные миграции позволяют создавать и применять миграции вручную.

Для работы с хранимыми процедурами в DbContext используются методы контекста базы данных, такие как `Database.SqlQuery` и `ExecuteSqlCommand`. Они позволяют вызывать хранимые процедуры и обрабатывать результаты их выполнения.

Для работы с несколькими контекстами данных в EntityFramework используются следующие методы:
- `DbContext.Database.UseTransaction(transaction)` - устанавливает транзакцию для контекста базы данных
- `DbContext.Database.BeginTransaction()` - начинает новую транзакцию для контекста базы данных
- `DbContext.Database.CommitTransaction()` - коммитит текущую транзакцию для контекста базы данных
- `DbContext.Database.RollbackTransaction()` - откатывает текущую транзакцию для контекста базы данных

DbContext поддерживает следующие типы кэширования данных: кэширование первого уровня (Local Cache), кэширование второго уровня (Query Cache) и кэширование третьего уровня (Result Cache).

Для работы с агрегатными функциями в DbContext используются методы расширения `Queryable`, такие как `Sum`, `Count`, `Average`, `Min`, `Max` и другие.

Для фильтрации данных в DbContext можно использовать методы расширения `Queryable`, такие как `Where`, `OrderBy`, `Take`, `Skip` и другие. Они позволяют выбирать только необходимые данные из базы данных.

Для работы с индексами в DbContext в EntityFramework можно использовать следующие методы:
- `modelBuilder.Entity<T>().HasIndex(indexExpression)` - определяет индекс для указанного свойства или группы свойств
- `modelBuilder.Entity<T>().HasIndex(indexName, indexExpression)` - определяет индекс с указанным именем для указанного свойства или группы свойств
- `modelBuilder.Entity<T>().HasIndex(indexName, indexExpression).IsUnique()` - определяет уникальный индекс с указанным именем для указанного свойства или группы свойств

Для профилирования и отладки запросов в DbContext в EntityFramework можно использовать различные инструменты, включая:
- SQL Server Profiler - для отслеживания выполнения запросов к базе данных
- Entity Framework Profiler - для отслеживания выполнения запросов и работы с контекстом базы данных
- MiniProfiler - для профилирования запросов в режиме реального времени
- Glimpse - для отображения информации о запросах и других операциях в браузере

Для работы с группировкой и сортировкой данных в DbContext в EntityFramework можно использовать следующие методы:
- `DbSet.GroupBy(keySelector)` - группирует записи по заданному ключу
- `DbSet.OrderBy(orderByExpression)` - сортирует записи в базе данных по заданному выражению
- `DbSet.ThenBy(thenByExpression)` - выполняет дополнительную сортировку записей по заданному выражению после первичной сортировки
- `DbSet.OrderByDescending(orderByExpression)` - выполняет обратную сортировку записей по заданному выражению
- `DbSet.ThenByDescending(thenByExpression)` - выполняет дополнительную обратную сортировку записей по заданному выражению после первичной сортировки.
